!function(){function e(){window.ccm[n].component(t)}var t={name:"news_feed",ccm:"https://akless.github.io/ccm/version/ccm-11.5.0.min.js",config:{storeConfig:{store:"newsFeed",url:"https://ccm.inf.h-brs.de"},store:"",user:["ccm.instance","https://akless.github.io/ccm-components/user/ccm.user.min.js"],enableOffline:"true",useOwnServiceWorker:"true",css:["ccm.load","style.css"],html:{inputArea:{tag:"div",class:"new-post-container",inner:[{tag:"form",class:"new-post-form",onsubmit:"%action%",inner:[{tag:"div",class:"new-post-input",inner:[{tag:"input",class:"new-post-title",type:"text",placeholder:"Title goes here ..."},{tag:"textarea",class:"new-post-text",rows:"3",placeholder:"Something really important ...   "}]},{tag:"input",class:"new-post-submit",type:"submit",disabled:"true"}]}]},postsArea:{tag:"div",class:"posts-area"},post:{tag:"div",class:"post",inner:[{tag:"div",class:"head",inner:[{tag:"div",class:"user",inner:[{tag:"div",class:"name",inner:"%user%"}]},{tag:"div",class:"title",inner:[{tag:"div",inner:"%title%"},{tag:"div",class:"date",inner:"%date%"}]},{tag:"div",class:"status-indicator",inner:[{tag:"div",class:"%status%"}]}]},{tag:"div",class:"content",inner:{tag:"div",inner:"%text%"}}]}}},Instance:function(){const e=this;let t={};const r="get-posts";this.ready=function(r){t=e.ccm.helper.privatize(e),"serviceWorker"in navigator&&"true"===t.enableOffline&&("true"===t.useOwnServiceWorker&&navigator.serviceWorker.register("./serviceworker.js"),navigator.serviceWorker.addEventListener("message",d)),t.store=e.ccm.store(t.storeConfig),r&&r()},this.start=function(a){e.user.addObserver("newsfeed",l),e.user.start(),s(),"serviceWorker"in navigator&&"true"===t.enableOffline?navigator.serviceWorker.controller?navigator.serviceWorker.controller.postMessage({tag:r,url:t.storeConfig.url+"?store="+t.storeConfig.store}):navigator.serviceWorker.ready.then(e=>{e.active.postMessage({tag:r,url:t.storeConfig.url+"?store="+t.storeConfig.store})}):t.store.get(e=>{o(e)}),n(),a&&a()};const s=function(){let r=e.ccm.helper.html(t.html.inputArea,{action:i});e.element.appendChild(r)},n=function(){let r=e.element.querySelector(".posts-area"),s=e.ccm.helper.html(t.html.postsArea);r?e.element.replaceChild(s,r):e.element.appendChild(s)},o=function(e){n(),e.sort(g),e.forEach(a)},a=function(r,s=""){let n=e.element.querySelector(".posts-area"),o=new Date(r.date),a=e.ccm.helper.html(t.html.post,{title:r.title,date:o.toLocaleDateString(),user:r.user,text:r.text,status:s});n.firstChild?n.insertBefore(a,n.childNodes[0]):n.appendChild(a)},i=function(r){r.preventDefault();const s=e.element.querySelector(".new-post-text"),n=e.element.querySelector(".new-post-title"),o=s.value,i=n.value;s.value="",n.value="";const l={title:i,text:o,date:(new Date).getTime(),user:e.user.data().name||""};"serviceWorker"in navigator&&"true"===t.enableOffline?(a(l,"waiting"),c(l)):(a(l),t.store.set(l))},c=function(e){let r="",s=new URLSearchParams;s.append("store",t.storeConfig.store),s.append("dataset[title]",e.title),s.append("dataset[text]",e.text),s.append("dataset[date]",e.date),s.append("dataset[user]",e.user),s.append("dataset[key]",Math.floor(1e3*Math.random()+1)),r=t.storeConfig.url+"?"+s.toString(),navigator.serviceWorker.controller?navigator.serviceWorker.controller.postMessage({tag:"send-post",url:r}):navigator.serviceWorker.ready.then(e=>{e.active.postMessage({tag:"send-post",url:r})})},l=function(t){e.element.querySelector(".new-post-submit").disabled=!t},d=function(e){switch(console.log("[News-feed] Msg from sw: ",e),e.data.tag){case"got-posts":o(e.data.posts);break;case"posts-sent":navigator.serviceWorker.controller?navigator.serviceWorker.controller.postMessage({tag:r,url:t.storeConfig.url+"?store="+t.storeConfig.store}):navigator.serviceWorker.ready.then(e=>{e.active.postMessage({tag:r,url:t.storeConfig.url+"?store="+t.storeConfig.store})});break;default:console.log("[News-feed] No handler for msg-tag: ",e.data.tag)}},g=(e,t)=>e.date>=t.date?1:-1}},r="ccm."+t.name+(t.version?"-"+t.version.join("."):"")+".js";if(window.ccm&&null===window.ccm.files[r])window.ccm.files[r]=t;else{var s=window.ccm&&window.ccm.components[t.name];s&&s.ccm&&(t.ccm=s.ccm),"string"==typeof t.ccm&&(t.ccm={url:t.ccm});var n=t.ccm.url.split("/").pop().split("-");if(n.length>1?((n=n[1].split(".")).pop(),"min"===n[n.length-1]&&n.pop(),n=n.join(".")):n="latest",window.ccm&&window.ccm[n])e();else{var o=document.createElement("script");document.head.appendChild(o),t.ccm.integrity&&o.setAttribute("integrity",t.ccm.integrity),t.ccm.crossorigin&&o.setAttribute("crossorigin",t.ccm.crossorigin),o.onload=function(){e(),document.head.removeChild(o)},o.src=t.ccm.url}}}();